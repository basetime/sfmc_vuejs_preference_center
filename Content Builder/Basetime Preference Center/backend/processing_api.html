<script runat="server">
  Platform.Load("core", "1.1.1");
  Platform.Response.SetResponseHeader("Access-Control-Allow-Origin", "*");
  Platform.Response.SetResponseHeader('Strict-Transport-Security', 'max-age=200');
  Platform.Response.SetResponseHeader('X-XSS-Protection', '1; mode=block');
  Platform.Response.SetResponseHeader('X-Frame-Options', 'Deny');
  Platform.Response.SetResponseHeader('X-Content-Type-Options', 'nosniff');
  Platform.Response.SetResponseHeader('Referrer-Policy', 'strict-origin-when-cross-origin');
  Platform.Response.SetResponseHeader('Content-Security-Policy', "default-src 'self'");


  var postData = Platform.Request.GetPostData();
  var postJSON = Platform.Function.ParseJSON(postData);

  var action = Platform.Request.GetQueryStringParameter('action');
  var payload = Platform.Request.GetQueryStringParameter('payload');

  var applicationConfiguration = Platform.Function.ContentBlockByName('Content Builder\\Basetime Preference Center\\configurations\\app_configuration')
  var applicationConfigurationJSON = Platform.Function.ParseJSON(applicationConfiguration)
  var preferenceCenterDataExtensionExternalKey = applicationConfigurationJSON.preferenceCenterDataExtensionExternalKey;

  Platform.Function.ContentBlockByName('Content Builder\\Basetime Preference Center\\lib\\ssjs\\wsProxy')
  // Platform.Function.ContentBlockByName('Content Builder\\Basetime Preference Center\\lib\\ssjs\\utils')
  // var utils = util();
  var wsFn = wsProxy();

  var res = ''


  //Begin API Control Block
  //Run specific set of code/functions based on the 'action' parameter
  //After code is finished, the 'response' function returns the output and 'break' stops the processing
  switch (action) {
    case 'submitPreferenceForm':
 
        //update item
        var updateConfig = {
          soapObjName: "DataExtensionObject",
          options: {
            SaveOptions: [{
              PropertyName: "*",
              SaveAction: "UpdateAdd"
            }]
          },
          payload: {
            CustomerKey: preferenceCenterDataExtensionExternalKey,
            Properties: postJSON.postData.updatedInfo
          }
        }

        var updatePreferences = wsFn.update(updateConfig);
        res = updatePreferences;
        Write(Stringify(res))
        
      break;
  };




</script>